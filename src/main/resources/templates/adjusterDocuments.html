<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title th:text="${title}">Documents</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
	<div class="container py-4">
		<div class="d-flex justify-content-between align-items-center mb-3 header-gradient">
			<h3 class="mb-0" th:text="${title}">Documents</h3>
			<a href="/user/adjusterDashboard" class="btn btn-outline-light btn-sm">Back to Dashboard</a>
		</div>
		<div class="card">
			<div class="card-body p-0">
				<div class="table-responsive">
					<table class="table table-striped mb-0">
						<thead class="table-light">
							<tr>
								<th>ID</th>
								<th>Claim ID</th>
								<th>Policy Number</th>
								<th>Name</th>
								<th>Type</th>
								<th>View</th>
								<th>Verification</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="d : ${documents}">
								<td th:text="${d.documentId}">1</td>
								<td th:text="${d.claimId}">500</td>
								<td th:text="${policyNumbersForClaims[d.claimId]}">POL-001</td>
								<td th:text="${d.documentName}">file.pdf</td>
								<td th:text="${d.documentType}">PDF</td>
								<td>
									<a class="btn btn-sm btn-primary" th:href="@{'/documents/' + ${d.documentId} + '/file'}" target="_blank">View</a>
								</td>
								<td>
									<span class="badge bg-secondary" th:text="${d.verificationStatus != null} ? ${d.verificationStatus} : 'PENDING'">PENDING</span>
								</td>
								<td>
									<button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#verifyModal" th:attr="data-doc-id=${d.documentId}">Update</button>
								</td>
							</tr>
							<tr th:if="${documents == null or #lists.isEmpty(documents)}">
								<td colspan="8" class="text-center text-muted py-4">No documents to display.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<!-- Verify/Reject Modal -->
	<div class="modal fade" id="verifyModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Update Document Verification</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<form id="verifyForm" method="post">
					<div class="modal-body">
						<div class="mb-3">
							<label class="form-label">Verification Status</label>
							<select name="status" class="form-select" required>
								<option value="VERIFIED">VERIFIED</option>
								<option value="REJECTED">REJECTED</option>
							</select>
							<input type="hidden" name="redirectTo" value="/api/adjuster/documents/verified" />
						</div>

					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-success">Save</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		const verifyModal = document.getElementById('verifyModal');
		const verifyForm = document.getElementById('verifyForm');
		verifyModal.addEventListener('show.bs.modal', function (event) {
			const button = event.relatedTarget;
			if (!button) return;
			const docId = button.getAttribute('data-doc-id');
			verifyForm.action = '/api/adjuster/documents/' + docId + '/verify';
		});
	</script>
</body>
</html> 